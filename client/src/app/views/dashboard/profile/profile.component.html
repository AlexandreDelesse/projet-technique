<div class="row" *ngIf="user">
  <div class="col-md-12 mb-3">
    <h4 class="dashboard-heading">Informations personelles</h4>

    <h5 class="dashboard-subheading">Mes Informations</h5>
    <form
      method="POST"
      (ngSubmit)="changePersonalInfo()"
      #form="ngForm"
      class="mb-5"
    >
      <div class="form-group row">
        <label for="firstname" class="col-sm-3 col-form-label">Prénom</label>
        <div class="col-sm-9">
          <input
            id="firstname"
            type="text"
            class="form-control"
            [(ngModel)]="user.firstname"
            #firstname="ngModel"
            name="firstname"
            required
            (keydown)="errors.firstname = []"
          />
          <small class="form-help text-danger" *ngIf="errors.firstname">
            {{ errors.firstname[0] }}
          </small>
          <small
            class="form-help text-danger"
            *ngIf="firstname.invalid && (firstname.dirty || firstname.touched)"
          >
            <span *ngIf="firstname.errors && firstname.errors.required">
              Ce champ est obligatoire.
            </span>
          </small>
        </div>
      </div>
      <div class="form-group row">
        <label for="lastname" class="col-sm-3 col-form-label">Nom</label>
        <div class="col-sm-9">
          <input
            id="lastname"
            type="text"
            class="form-control"
            [(ngModel)]="user.lastname"
            #lastname="ngModel"
            name="lastname"
            required
            (keydown)="errors.lastname = []"
          />
          <small class="form-help text-danger" *ngIf="errors.lastname">
            {{ errors.lastname[0] }}
          </small>
          <small
            class="form-help text-danger"
            *ngIf="lastname.invalid && (lastname.dirty || lastname.touched)"
          >
            <span *ngIf="lastname.errors && lastname.errors.required">
              Ce champ est obligatoire.
            </span>
          </small>
        </div>
      </div>
      <div class="form-group row">
        <label for="birthdate" class="col-sm-3 col-form-label"
          >Date de naissance</label
        >
        <div class="col-sm-9">
          <input
            id="birthdate"
            class="form-control"
            type="datetime"
            [owlDateTime]="dt1"
            [owlDateTimeTrigger]="dt1"
            [(ngModel)]="user.birthdate"
            #birthdate="ngModel"
            name="birthdate"
            (keydown)="errors.birthdate = []"
          />
          <small class="form-help text-danger" *ngIf="errors.birthdate">
            {{ errors.birthdate[0] }}
          </small>
          <owl-date-time [pickerType]="'calendar'" #dt1></owl-date-time>
        </div>
      </div>
      <div class="form-group row">
        <label for="blood" class="col-sm-3 col-form-label">
          Groupe sanguin
        </label>
        <div class="col-sm-9">
          <select
            class="form-control"
            id="blood"
            name="blood"
            [(ngModel)]="user.bloodgroup_id"
            #blood="ngModel"
            (keydown)="errors.bloodgroup_id = []"
          >
            <option value="" disabled>Séléctionnez votre groupe sanguin</option>
            <option value="1">A <sup>+</sup></option>
            <option value="2">A <sup>-</sup></option>
            <option value="3">B <sup>+</sup></option>
            <option value="4">B <sup>-</sup></option>
            <option value="5">AB <sup>+</sup></option>
            <option value="6">AB <sup>-</sup></option>
            <option value="8">O <sup>+</sup></option>
            <option value="9">O <sup>-</sup></option>
          </select>
          <small class="form-help text-danger" *ngIf="errors.bloodgroup_id">
            {{ errors.bloodgroup_id[0] }}
          </small>
        </div>
      </div>
      <div class="form-group row">
        <label for="gender" class="col-sm-3 col-form-label">Sexe</label>
        <div class="col-sm-9">
          <select
            class="form-control"
            id="gender"
            name="gender"
            [(ngModel)]="user.gender"
            #gender="ngModel"
            (keydown)="errors.gender = []"
          >
            <option value="Male">Homme</option>
            <option value="Female">Femme</option>
          </select>
          <small class="form-help text-danger" *ngIf="errors.gender">
            {{ errors.gender[0] }}
          </small>
        </div>
      </div>
      <div class="form-group row">
        <label for="email" class="col-sm-3 col-form-label">Email</label>
        <div class="col-sm-9">
          <input
            id="email"
            type="email"
            class="form-control"
            [(ngModel)]="user.email"
            #email="ngModel"
            name="email"
            required
            email
            (keydown)="errors.email = []"
          />
          <small class="form-help text-danger" *ngIf="errors.email">
            {{ errors.email[0] }}
          </small>
          <small
            class="form-help text-danger"
            *ngIf="email.invalid && (email.dirty || email.touched)"
          >
            <span *ngIf="email.errors && email.errors.required">
              Ce champ est obligatoire.
            </span>
            <span *ngIf="email.errors && email.errors.email">
              Veuillez entre une adresse mail valide.
            </span>
          </small>
        </div>
      </div>
      <div class="form-group row">
        <label for="phone" class="col-sm-3 col-form-label">
          Numéro de téléphone
        </label>
        <div class="col-sm-9">
          <input
            id="phone"
            type="text"
            class="form-control"
            [(ngModel)]="user.phone"
            #phone="ngModel"
            name="phone"
            (keydown)="errors.phone = []"
          />
          <small class="form-help text-danger" *ngIf="errors.phone">
            {{ errors.phone[0] }}
          </small>
          <small
            class="form-help text-danger"
            *ngIf="phone.invalid && (phone.dirty || phone.touched)"
          >
          </small>
        </div>
      </div>
      <div class="form-group">
        <button class="btn btn-success" type="submit" [disabled]="form1Loading">
          <span *ngIf="!form1Loading">Modifier</span>
          <div
            class="spinner-border spinner-border-sm"
            role="status"
            *ngIf="form1Loading"
          >
            <span class="sr-only">Chargement...</span>
          </div>
        </button>
      </div>
    </form>

    <h5 class="dashboard-subheading">Mon Adresse</h5>

    <form method="POST" (ngSubmit)="changeAdress()" #adressForm="ngForm">
      <div class="form-group">
        <label for="label">Adresse</label>
        <input
          id="label"
          type="text"
          class="form-control"
          [(ngModel)]="adress"
          [ngbTypeahead]="search"
          [resultFormatter]="formatter"
          [inputFormatter]="formatter"
          [editable]="false"
          #label="ngModel"
          name="label"
          required
        />
        <small
          class="form-help text-danger"
          *ngIf="label.invalid && (label.dirty || label.touched)"
        >
          <span *ngIf="label.errors && label.errors.required">
            Le champ adresse est obligatoire.
          </span>
        </small>
      </div>
      <div class="form-group">
        <button
          class="btn btn-success"
          type="submit"
          [disabled]="isLoading || label.invalid"
        >
          <span *ngIf="!isLoading">Changer adresse</span>
          <div
            class="spinner-border spinner-border-sm"
            role="status"
            *ngIf="isLoading"
          >
            <span class="sr-only">Chargement...</span>
          </div>
        </button>
      </div>
    </form>
  </div>
</div>

<app-flash-alert
  [show]="showSuccessAlert"
  [message]="successMessage"
></app-flash-alert>

<app-flash-alert
  [show]="showErrorAlert"
  [message]="'Une erreur s\'est produit, veuillez réessayer. '"
  [type]="'danger'"
></app-flash-alert>
